<!DOCTYPE html>
<html>
<head>
    <title>GST Reconciliation Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center mb-4">üßæ GST Reconciliation Dashboard</h1>
        
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">‚úÖ Matched</h5>
                        <h2>{{ summary.matched_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-danger">
                    <div class="card-body">
                        <h5 class="card-title">‚ùå Not in GSTR2B</h5>
                        <h2>{{ summary.not_in_gstr2b_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h5 class="card-title">‚ö†Ô∏è Not in Books</h5>
                        <h2>{{ summary.not_in_books_count }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-info">
                    <div class="card-body">
                        <h5 class="card-title">üìä Total Records</h5>
                        <h2>{{ summary.total_records }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="row mb-4">
            <div class="col-md-6">
                <canvas id="reconciliationChart"></canvas>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìà Reconciliation Status</h5>
                        <p>Matched Rate: <strong>{{ "%.1f"|format((summary.matched_count / summary.total_records * 100) if summary.total_records > 0 else 0) }}%</strong></p>
                        <p>Unmatched Rate: <strong>{{ "%.1f"|format(((summary.not_in_gstr2b_count + summary.not_in_books_count) / summary.total_records * 100) if summary.total_records > 0 else 0) }}%</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs for detailed data -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="matched-tab" data-bs-toggle="tab" data-bs-target="#matched" type="button">‚úÖ Matched Records</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="not-gstr2b-tab" data-bs-toggle="tab" data-bs-target="#not-gstr2b" type="button">‚ùå Not in GSTR2B</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="not-books-tab" data-bs-toggle="tab" data-bs-target="#not-books" type="button">‚ö†Ô∏è Not in Books</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="matched" role="tabpanel">
                <div class="mt-3">
                    <h4>Matched Records ({{ summary.matched_count }})</h4>
                    <div class="table-responsive">
                        {{ matched|safe }}
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="not-gstr2b" role="tabpanel">
                <div class="mt-3">
                    <h4>Records in Purchase but Not in GSTR2B ({{ summary.not_in_gstr2b_count }})</h4>
                    <div class="table-responsive">
                        {{ not_in_gstr2b|safe }}
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="not-books" role="tabpanel">
                <div class="mt-3">
                    <h4>Records in GSTR2B but Not in Books ({{ summary.not_in_books_count }})</h4>
                    <div class="table-responsive">
                        {{ not_in_books|safe }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Create pie chart
        const ctx = document.getElementById('reconciliationChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Matched', 'Not in GSTR2B', 'Not in Books'],
                datasets: [{
                    data: [{{ summary.matched_count }}, {{ summary.not_in_gstr2b_count }}, {{ summary.not_in_books_count }}],
                    backgroundColor: ['#28a745', '#dc3545', '#ffc107']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'GST Reconciliation Summary'
                    }
                }
            }
        });
    </script>
</body>
</html>